# Шама - Карточная игра через Telegram

Этот проект представляет собой реализацию классической карточной игры "Шама" в виде Telegram бота, позволяющего играть удаленно с друзьями.

## Особенности

- Полная реализация правил игры "Шама"
- Игра через сообщения в Telegram
- Создание игровых комнат с приглашениями по ссылке
- Визуализация карт и состояния игры
- Хранение статистики игроков
- Логирование всех действий
- Поддержка нескольких одновременных игр

## Структура проекта

- `backend/core.py` - Ядро игрового движка
- `backend/constants.py` - Константы игры
- `backend/game_tg_bot.py` - Реализация Telegram бота
- `backend/storage_factory.py` - Определение хранилища
- `backend/database_manager.py` - Взаимодействие с базой данных
- `backend/file_storage.py` - Взаимодействие с файловым хранилищем
- `backend/tests/` - Тесты
- `TECHNICAL_SPEC.md` - Техническое задание

## Быстрый старт

### Предварительные требования

- Python 3.8+
- Telegram Bot API токен
будут дополняться

### Установка зависимостей

1. Клонируйте репозиторий:

```bash
git clone https://github.com/Arroch/ShamaCardGame
cd ShamaCardGame
```

2. Создайте и активируйте виртуальное окружение:

```bash
# Создание виртуального окружения
python -m venv venv

# Активация виртуального окружения
# На macOS/Linux:
source venv/bin/activate
# На Windows:
# venv\Scripts\activate
```

3. Установите зависимости:

```bash
# В активированном виртуальном окружении
pip install -r backend/requirements.txt
```

### Создание Telegram бота

1. Создайте нового бота у [@BotFather](https://t.me/BotFather) в Telegram и получите токен
2. Установите токен как переменную окружения:

```bash
# На macOS/Linux:
export TELEGRAM_BOT_TOKEN=ваш_токен_бота
# На Windows:
# set TELEGRAM_BOT_TOKEN=ваш_токен_бота
```

### Запуск бота

```bash
cd backend
python game_tg_bot.py
```

## Использование

### Команды бота

- `/start` - Начать взаимодействие с ботом
- `/help` - Показать справку по командам
- `/rules` - Показать правила игры
- `/create_game` - Создать новую игру
- `/join_game` - Присоединиться к игре по коду (если нет ссылки)
- `/stats` - Показать вашу статистику

### Создание и присоединение к игре

1. Используйте команду `/create_game` для создания новой игры
2. Отправьте полученную ссылку-приглашение другим игрокам
3. Каждый игрок может присоединиться к игре, перейдя по ссылке
4. Как только все 4 игрока присоединятся, игра начнется автоматически

### Процесс игры

1. Игрок с шестеркой треф (шамой) выбирает козырь
2. Игроки ходят картами в порядке очереди
3. Игра продолжается до тех пор, пока одна из команд не наберет 12 или более очков

### Настройка хранилища данных (в разработке, работает только Файловое хранилище)

Бот поддерживает два типа хранилища данных:
1. **Файловое хранилище** (по умолчанию) - данные хранятся в CSV-файлах в локальной директории
2. **PostgreSQL** - данные хранятся в базе данных PostgreSQL

#### Настройка файлового хранилища

По умолчанию файлы хранятся в директории `backend/storage`.

#### Настройка PostgreSQL (опционально)

1. Создайте базу данных в PostgreSQL:

```sql
CREATE DATABASE shama_game;
```

2. Установите переменные окружения для доступа к базе данных:

```bash
export STORAGE_TYPE=postgres
export DB_HOST=localhost
export DB_PORT=5432
export DB_NAME=shama_game
export DB_USER=ваш_пользователь
export DB_PASSWORD=ваш_пароль
```

## Правила игры

Подробные правила игры "Шама" можно найти в [TECHNICAL_SPEC.md](TECHNICAL_SPEC.md).

## Разработка

### Запуск тестов

```bash
cd backend
pytest
```

### Логирование

Логи бота и игровых сессий сохраняются в консоли и в базе данных.

## Лицензия

Проект распространяется под лицензией [MIT](LICENSE).
